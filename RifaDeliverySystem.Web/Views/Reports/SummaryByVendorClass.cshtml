@model List<RifaDeliverySystem.Web.ViewModels.Reports.VendorByClassGroupViewModel>

@{
    ViewData["Title"] = "Resumen por Clase";
}

<h2>@ViewData["Title"]</h2>
<div class="mb-3">
    <a asp-action="ExportSummaryByVendorClassPdf" class="btn btn-outline-primary me-2">
        Exportar CSV
    </a>
    <a asp-action="ExportSummaryByVendorClassExcel" class="btn btn-outline-success">
        Exportar Excel
    </a>
</div>

@foreach (var group in Model)
{
    <h3>Clase: @group.Class</h3>
    <table class="table table-bordered table-sm">
        <thead>
            <tr>
                <th>Vendedor</th>
                <th>Vendidos</th>
                <th>Retornados</th>
                <th>Extravio</th>
                <th>Robo</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var v in group.Vendors)
            {
                <tr>
                    <td>@v.Name</td>
                    <td>@v.Sold</td>
                    <td>@v.Returned</td>
                    <td>@v.Extravio</td>
                    <td>@v.Robo</td>
                </tr>
            }
            <tr class="fw-bold text-end table-secondary">
                <td class="text-start">Subtotal</td>
                <td>@group.TotalSold</td>
                <td>@group.TotalReturned</td>
                <td>@group.TotalExtravio</td>
                <td>@group.TotalRobo</td>
            </tr>
        </tbody>
    </table>
}

@* Grand total across all classes *@
@{
    var grandTotalSold = Model.Sum(g => g.TotalSold);
    var grandTotalReturned = Model.Sum(g => g.TotalReturned);
    var grandTotalExtravio = Model.Sum(g => g.TotalExtravio);
    var grandTotalRobo = Model.Sum(g => g.TotalRobo);
}
<h3>Totales Generales</h3>
<table class="table table-bordered table-sm">
    <thead>
        <tr>
            <th class="text-start">Total Vendidos</th>
            <th>Total Retornados</th>
            <th>Total Extravio</th>
            <th>Total Robo</th>
        </tr>
    </thead>
    <tbody>
        <tr class="fw-bold text-end table-secondary">
            <td class="text-start">@grandTotalSold</td>
            <td>@grandTotalReturned</td>
            <td>@grandTotalExtravio</td>
            <td>@grandTotalRobo</td>
        </tr>
    </tbody>
</table>
